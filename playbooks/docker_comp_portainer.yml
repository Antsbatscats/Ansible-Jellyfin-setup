--- 
  - name: Docker, Docker-Compose and Portainer install and setup
    hosts: server1
    user: antsbatscats1234
    become: yes
    vars: 
      docker_compose_version: 2.16.0
    tasks: 
      - name: Update and Upgrade
        apt: 
          update_cache: yes
          cache_valid_time: 3600
          upgrade: yes
        when: ansible_distribution == "debian"

      - name: Install Dependancies
        apt: 
          name: "{{ packages }}"
          state: present
          update_cache: yes
        vars: 
          packages: 
            - apt-transport-https
            - ca-certificates
            - curl 
            - software-properties-common
            - gnupg-agent
        when: ansible_distribution == "debian"
      
      - name: Add an apt signing key for Docker
        apt_key:
          url: https://download.docker.com/linux/debian/gpg
          state: present

      - name: Add apt repository for stable version
        apt_repository:
          repo: deb [arch=amd64] https://download.docker.com/linux/debian bullseye stable
          state: present

      - name: Install Docker
        apt: 
          name: "{{ packages }}"
          state: present
          update_cache: yes
        vars:
          packages: 
            - docker-ce
            - docker-ce-cli
            - containerd.io
        when: ansible_distribution == "debian"
      
      - name: Add user to docker group
        user: 
          name: "{{ ansible_user }}"
          group: docker
                  

